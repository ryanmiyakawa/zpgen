# Git Commit Guide for zpgen-wasm

## Summary

✅ **Safe to commit**: ~304KB (22 files)
❌ **Ignored**: ~167MB build artifacts (target/, pkg/)

## What Gets Committed

### Source Code (Required)
```
src/
├── lib.rs              # Library entry point
├── solver.rs           # Numerical solver
├── transforms.rs       # Coordinate transformations
├── zernike.rs          # Zernike polynomials
├── geometry.rs         # Pupil masks
├── gds.rs              # GDS file export
├── zpgen.rs            # Main generation logic
└── wasm.rs             # WASM bindings
```

### Configuration (Required)
```
Cargo.toml              # Rust dependencies
Cargo.lock              # Locked dependency versions
.gitignore              # Git ignore rules
```

### Documentation (Recommended)
```
README.md               # Project overview
DEPLOYMENT.md           # React integration guide
PROGRESS.md             # Migration details
SUCCESS.md              # Completion summary
TEST_RESULTS.md         # Test verification
COMMIT_GUIDE.md         # This file
```

### Scripts (Required)
```
build-wasm.sh           # WASM build script
start-server.sh         # Dev server script
```

### Examples (Recommended)
```
examples/
├── browser/
│   └── index.html      # Browser demo
└── test_native.rs      # Native test example
```

### Tests (Recommended)
```
tests/
└── test_generation.rs  # Integration tests
```

## What Gets Ignored (via .gitignore)

### Build Artifacts (~167MB)
```
target/                 # Cargo build output
*.rlib                  # Rust libraries
libtransforms.rlib      # Generated file
```

### Generated WASM (~140KB)
```
examples/browser/pkg/   # Can be regenerated with ./build-wasm.sh
pkg/                    # Alternative output location
```

### Temporary Files
```
*.log                   # Server logs
*.gds                   # Generated zone plates
*.tmp, *.bak            # Backup files
.DS_Store               # macOS metadata
```

## Verification Before Commit

Run this to see what will be committed:

```bash
cd /Users/rhmiyakawa/Documents/Xcode/zpgen/ZPGen/ZPGen/ZPGen/zpgen-wasm

# Check size (should be ~300KB, not 167MB)
du -sh .

# List files to commit (should be ~22 files)
find . -type f ! -path './target/*' ! -path './examples/browser/pkg/*' ! -path './.git/*' ! -name '.DS_Store'

# Check git status
git status
```

## Recommended Commit Message

```
Add Rust+WASM port of ZPGenHolo

- Complete port of C++ zone plate generator to Rust
- WebAssembly support for browser-based generation
- All core algorithms ported and tested
- Streaming GDS export for large files
- 15/15 unit tests passing
- Integration tested with real zone plate generation
- Documentation for React integration

Files: 22 source/doc files (~304KB)
Build artifacts excluded via .gitignore
```

## After Committing

Users can rebuild everything with:

```bash
# Clone/pull the repo
git pull

# Build native version
cargo build --release

# Build WASM for browser
./build-wasm.sh

# Run tests
cargo test
```

## Updating After C++ Changes

If you modify the C++ code and need to sync to Rust:

1. **Identify changes**:
   ```bash
   git diff src/zpGenHolo.cpp
   ```

2. **Update corresponding Rust file**:
   ```
   C++ file → Rust file
   zpGenHolo.cpp → src/zpgen.rs
   zpUtils.cpp → src/transforms.rs, src/zernike.rs, src/geometry.rs
   patternFileUtils.cpp → src/gds.rs
   ```

3. **Test changes**:
   ```bash
   cd zpgen-wasm
   cargo test
   ```

4. **Rebuild WASM**:
   ```bash
   ./build-wasm.sh
   ```

5. **Commit both**:
   ```bash
   git add src/zpGenHolo.cpp zpgen-wasm/src/zpgen.rs
   git commit -m "Update secant solver algorithm (C++ and Rust)"
   ```

## Notes

- **Cargo.lock** is committed (standard for applications, optional for libraries)
- **examples/browser/pkg/** is ignored (generated by `./build-wasm.sh`)
- **target/** is ignored (generated by `cargo build`)
- All documentation is committed for reference
- Build scripts are committed so others can reproduce builds

## File Sizes

| Directory/File | Size | Status |
|---------------|------|--------|
| Total (clean) | ~304KB | ✅ Commit |
| target/ | ~167MB | ❌ Ignored |
| examples/browser/pkg/ | ~140KB | ❌ Ignored |
| Source code | ~50KB | ✅ Commit |
| Documentation | ~60KB | ✅ Commit |
| Tests | ~20KB | ✅ Commit |
